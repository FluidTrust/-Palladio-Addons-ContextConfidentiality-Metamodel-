/**
 */
package org.palladiosimulator.pcm.confidentiality.attacker.tests;

import org.junit.Assert;
import org.junit.jupiter.api.Test;
import org.palladiosimulator.pcm.confidentiality.attacker.tests.common.TestHelpers;
import org.palladiosimulator.pcm.confidentiality.attackerSpecification.AttackerFactory;
import org.palladiosimulator.pcm.confidentiality.attackerSpecification.attackSpecification.AttackComplexity;
import org.palladiosimulator.pcm.confidentiality.attackerSpecification.attackSpecification.AttackSpecificationFactory;
import org.palladiosimulator.pcm.confidentiality.attackerSpecification.attackSpecification.AttackVector;
import org.palladiosimulator.pcm.confidentiality.attackerSpecification.attackSpecification.AvailabilityImpact;
import org.palladiosimulator.pcm.confidentiality.attackerSpecification.attackSpecification.ConfidentialityImpact;
import org.palladiosimulator.pcm.confidentiality.attackerSpecification.attackSpecification.IntegrityImpact;
import org.palladiosimulator.pcm.confidentiality.attackerSpecification.attackSpecification.Privileges;
import org.palladiosimulator.pcm.confidentiality.attackerSpecification.attackSpecification.UserInteraction;

public class VulnerabilityFilterCriterionTest {
    @Test
    public void isElementFilteredTestAvailabilyImpact() {
        final var vulnerabilityHigh = TestHelpers.createCVEVulnerability(
                AttackSpecificationFactory.eINSTANCE.createCWEID(), AttackSpecificationFactory.eINSTANCE.createCVEID());
        vulnerabilityHigh.setAvailabilityImpact(AvailabilityImpact.HIGH);
        final var vulnerabilityLow = TestHelpers.createCVEVulnerability(
                AttackSpecificationFactory.eINSTANCE.createCWEID(), AttackSpecificationFactory.eINSTANCE.createCVEID());
        vulnerabilityLow.setAvailabilityImpact(AvailabilityImpact.LOW);
        final var filter = AttackerFactory.eINSTANCE.createImpactVulnerabilityFilterCriterion();
        filter.setAvailabilityImpactMinimum(AvailabilityImpact.HIGH);

        Assert.assertFalse(filter.isVulnerabilityInRange(vulnerabilityLow));
        vulnerabilityLow.setAvailabilityImpact(AvailabilityImpact.NONE);
        Assert.assertFalse(filter.isVulnerabilityInRange(vulnerabilityLow));

        Assert.assertTrue(filter.isVulnerabilityInRange(vulnerabilityHigh));
    }

    @Test
    public void isElementFilteredTestConfidentialityImpact() {
        final var vulnerabilityHigh = TestHelpers.createCVEVulnerability(
                AttackSpecificationFactory.eINSTANCE.createCWEID(), AttackSpecificationFactory.eINSTANCE.createCVEID());
        vulnerabilityHigh.setConfidentialityImpact(ConfidentialityImpact.HIGH);
        final var vulnerabilityLow = TestHelpers.createCVEVulnerability(
                AttackSpecificationFactory.eINSTANCE.createCWEID(), AttackSpecificationFactory.eINSTANCE.createCVEID());
        vulnerabilityLow.setConfidentialityImpact(ConfidentialityImpact.LOW);
        final var filter = AttackerFactory.eINSTANCE.createImpactVulnerabilityFilterCriterion();
        filter.setConfidentialityImpactMinimum(ConfidentialityImpact.HIGH);
        Assert.assertFalse(filter.isVulnerabilityInRange(vulnerabilityLow));
        vulnerabilityLow.setConfidentialityImpact(ConfidentialityImpact.NONE);
        Assert.assertFalse(filter.isVulnerabilityInRange(vulnerabilityLow));
        Assert.assertTrue(filter.isVulnerabilityInRange(vulnerabilityHigh));
        filter.setConfidentialityImpactMinimum(ConfidentialityImpact.LOW);
        Assert.assertTrue(filter.isVulnerabilityInRange(vulnerabilityHigh));
    }

    @Test
    public void isElementFilteredTestIntegrityImpact() {
        final var vulnerabilityHigh = TestHelpers.createCVEVulnerability(
                AttackSpecificationFactory.eINSTANCE.createCWEID(), AttackSpecificationFactory.eINSTANCE.createCVEID());
        vulnerabilityHigh.setIntegrityImpact(IntegrityImpact.HIGH);
        final var vulnerabilityLow = TestHelpers.createCVEVulnerability(
                AttackSpecificationFactory.eINSTANCE.createCWEID(), AttackSpecificationFactory.eINSTANCE.createCVEID());
        vulnerabilityLow.setIntegrityImpact(IntegrityImpact.LOW);
        final var filter = AttackerFactory.eINSTANCE.createImpactVulnerabilityFilterCriterion();
        filter.setIntegrityImpactMinimum(IntegrityImpact.HIGH);

        Assert.assertFalse(filter.isVulnerabilityInRange(vulnerabilityLow));
        vulnerabilityLow.setIntegrityImpact(IntegrityImpact.NONE);
        Assert.assertFalse(filter.isVulnerabilityInRange(vulnerabilityLow));

        Assert.assertTrue(filter.isVulnerabilityInRange(vulnerabilityHigh));
    }

    @Test
    public void isElementFilteredAttackVector() {
        final var vulnerabilityHigh = TestHelpers.createCVEVulnerability(
                AttackSpecificationFactory.eINSTANCE.createCWEID(), AttackSpecificationFactory.eINSTANCE.createCVEID());
        vulnerabilityHigh.setAttackVector(AttackVector.NETWORK);
        final var vulnerabilityLow = TestHelpers.createCVEVulnerability(
                AttackSpecificationFactory.eINSTANCE.createCWEID(), AttackSpecificationFactory.eINSTANCE.createCVEID());
        vulnerabilityLow.setAttackVector(AttackVector.ADJACENT_NETWORK);
        final var filter = AttackerFactory.eINSTANCE.createExploitabilityVulnerabilityFilterCriterion();
        filter.setAttackVectorMaximum(AttackVector.NETWORK);

        Assert.assertFalse(filter.isVulnerabilityInRange(vulnerabilityLow));
        vulnerabilityLow.setAttackVector(AttackVector.LOCAL);
        Assert.assertFalse(filter.isVulnerabilityInRange(vulnerabilityLow));

        Assert.assertTrue(filter.isVulnerabilityInRange(vulnerabilityHigh));
    }

    @Test
    public void isElementFilteredAttackComplexity() {
        final var vulnerabilityHigh = TestHelpers.createCVEVulnerability(
                AttackSpecificationFactory.eINSTANCE.createCWEID(), AttackSpecificationFactory.eINSTANCE.createCVEID());
        vulnerabilityHigh.setAttackComplexity(AttackComplexity.LOW);
        final var vulnerabilityLow = TestHelpers.createCVEVulnerability(
                AttackSpecificationFactory.eINSTANCE.createCWEID(), AttackSpecificationFactory.eINSTANCE.createCVEID());
        vulnerabilityLow.setAttackComplexity(AttackComplexity.HIGH);
        final var filter = AttackerFactory.eINSTANCE.createExploitabilityVulnerabilityFilterCriterion();
        filter.setAttackComplexityMaximum(AttackComplexity.LOW);

        Assert.assertFalse(filter.isVulnerabilityInRange(vulnerabilityLow));

        Assert.assertTrue(filter.isVulnerabilityInRange(vulnerabilityHigh));
    }

    @Test
    public void isElementFilteredPrivileges() {
        final var vulnerabilityHigh = TestHelpers.createCVEVulnerability(
                AttackSpecificationFactory.eINSTANCE.createCWEID(), AttackSpecificationFactory.eINSTANCE.createCVEID());
        vulnerabilityHigh.setPrivileges(Privileges.NONE);
        final var vulnerabilityLow = TestHelpers.createCVEVulnerability(
                AttackSpecificationFactory.eINSTANCE.createCWEID(), AttackSpecificationFactory.eINSTANCE.createCVEID());
        vulnerabilityLow.setPrivileges(Privileges.SPECIAL);
        final var filter = AttackerFactory.eINSTANCE.createExploitabilityVulnerabilityFilterCriterion();
        filter.setPrivilegesMaximum(Privileges.NONE);

        Assert.assertFalse(filter.isVulnerabilityInRange(vulnerabilityLow));
        vulnerabilityLow.setPrivileges(Privileges.LOW);
        Assert.assertFalse(filter.isVulnerabilityInRange(vulnerabilityLow));

        Assert.assertTrue(filter.isVulnerabilityInRange(vulnerabilityHigh));
    }

    @Test
    public void isElementFilteredUserInteraction() {
        final var vulnerabilityHigh = TestHelpers.createCVEVulnerability(
                AttackSpecificationFactory.eINSTANCE.createCWEID(), AttackSpecificationFactory.eINSTANCE.createCVEID());
        vulnerabilityHigh.setUserInteraction(UserInteraction.NONE);
        final var vulnerabilityLow = TestHelpers.createCVEVulnerability(
                AttackSpecificationFactory.eINSTANCE.createCWEID(), AttackSpecificationFactory.eINSTANCE.createCVEID());
        vulnerabilityLow.setUserInteraction(UserInteraction.REQUIRED);
        final var filter = AttackerFactory.eINSTANCE.createExploitabilityVulnerabilityFilterCriterion();
        filter.setUserInteractionMaximum(UserInteraction.NONE);
        Assert.assertFalse(filter.isVulnerabilityInRange(vulnerabilityLow));
        Assert.assertTrue(filter.isVulnerabilityInRange(vulnerabilityHigh));
    }
}
