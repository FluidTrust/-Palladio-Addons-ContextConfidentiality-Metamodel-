package org.palladiosimulator.pcm.confidentiality.attacker.helper;

import java.util.List;
import java.util.function.Function;
import java.util.stream.Collectors;

import org.eclipse.emf.ecore.EObject;
import org.eclipse.emf.ecore.util.EcoreUtil;
import org.palladiosimulator.pcm.confidentiality.attackerSpecification.VulnerabilitySystemSpecification;
import org.palladiosimulator.pcm.confidentiality.attackerSpecification.attackSpecification.Attack;
import org.palladiosimulator.pcm.confidentiality.attackerSpecification.attackSpecification.AttackVector;
import org.palladiosimulator.pcm.confidentiality.attackerSpecification.attackSpecification.Vulnerability;
import org.palladiosimulator.pcm.confidentiality.attackerSpecification.pcmIntegration.SystemIntegration;
import org.palladiosimulator.pcm.confidentiality.context.set.ContextSet;
import org.palladiosimulator.pcm.resourceenvironment.LinkingResource;

public final class VulnerabilityHelper {
    private VulnerabilityHelper() {
        assert false;
    }

    public static Vulnerability checkAttack(ContextSet credentials, List<ContextSet> policies,
            List<Vulnerability> vulnerabilities, List<Attack> attacks, AttackVector vector) {
        for (var policy : policies) {
            for (var vulnerability : vulnerabilities) {
                for (var attack : attacks) {
                    if (attack.canExploit(vulnerability, credentials, policy, vector)) {
                        return vulnerability;
                    }
                }
            }
        }
        return null;
    }

    public static List<Vulnerability> getVulnerabilities(VulnerabilitySystemSpecification vulnerabilityspecification,
            LinkingResource resource) {
        return getVulnerabilities(vulnerabilityspecification.getVulnerabilities(), resource);
    }

    public static List<Vulnerability> getVulnerabilities(List<SystemIntegration> vulnerabilitySpecification,
            LinkingResource resource) {
        return getVulnerbilities(vulnerabilitySpecification, SystemIntegration::getLinkingresource, resource);
    }

    private static List<Vulnerability> getVulnerbilities(List<SystemIntegration> specification,
            Function<SystemIntegration, EObject> method, EObject object) {
        return specification.stream().filter(e -> EcoreUtil.equals(method.apply(e), object))
                .map(SystemIntegration::getVulnerability).collect(Collectors.toList());
    }

}
